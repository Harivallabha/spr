description: AWM

target:
  cluster: eu1
  vc: msrlabs

environment:
  image: philly/jobs/custom/pytorch:pytorch1.3.1-py36-cuda10.0
  registry: phillyregistry.azurecr.io
  setup:
    - export PATH=$$PATH:~/.local/bin
    - export LC_ALL=C.UTF-8
    - export LANG=C.UTF-8
    - pip install --user opencv-python wandb matplotlib scikit-learn 'gym[atari]' recordclass pyprind psutil dill kornia==0.2.2
    - pip install --user git+git://github.com/mila-iqia/atari-representation-learning.git
    - pip install --user git+git://github.com/astooke/rlpyt
    - pip install --user pillow==6.2.1 scikit-image
    - wandb login fa235c4236ea0bd894bc3f26e87054a6ed6af293

# azure storage configuration
storage:
  my_storage:
    # Replace with the name of the Azure Storage Account you created.
    #   If you followed the tutorial, this should be your_username
    storage_account_name: ankdefault
    # Specify a name of the container on your blob (ex. phillytools),
    #   to store data, results and code. It will be created if it does not exist.
    container_name: awmcontainer

# data
#   data upload is not required for this example
search:
  job_template:
    name: rlpyt_nce84_{game:s}_{replay-ratio:d}_{arguments:s}_{random_string:s}
    sku: G1
    command:
      - NCCL_DEBUG=INFO python -m scripts.run_rlpyt --debug --game {game} {arguments} --learn-model --replay-ratio {replay-ratio} --n-gpu 1 --num-simulations 0 --eval-simulations 0 --encoder curl --jumps {jumps} --dynamics-blocks 4 --noisy-nets {noisy} --max-grad-norm {mgn} --nce 1 --classifier {classifier} --dueling {dueling} --seed {seed} --imagesize 100 --momentum-encoder 1 --buffered-nce {buffer} --local-nce {localnce}
  type: grid
  max_trials: 200
  params:
    - name: game
      spec: discrete
      values: ['alien', 'asterix', 'battle_zone', 'hero', 'ms_pacman', 'qbert', 'road_runner']
    - name: arguments
      spec: discrete
      values: ['--augmentation crop']
    - name: jumps
      spec: discrete
      values: [0]
    - name: noisy
      spec: discrete
      values: [0, 1]
    - name: replay-ratio
      spec: discrete
      values: [64]
    - name: mgn
      spec: discrete
      values: [100., 10.]
    - name: dueling
      spec: discrete
      values: [0]
    - name: seed
      spec: discrete
      values: [42, 123]
    - name: localnce
      spec: discrete
      values: [0]
    - name: buffer
      spec: discrete
      values: [0]
    - name: classifier
      spec: discrete
      values: ['bilinear']